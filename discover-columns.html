<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover Table Columns</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Discover Table Columns</h1>
        
        <button onclick="discoverColumns()">Discover "Products" Table Columns</button>
        <button onclick="listAllTables()">List All Tables</button>
        <button onclick="testSampleData()">Test Sample Data from Products</button>
        
        <div id="output" class="output">
            <div class="info">Click a button above to discover your table structure...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearLog() {
            document.getElementById('output').innerHTML = '';
        }

        async function discoverColumns() {
            clearLog();
            log('üîç Discovering columns in "Products" table...', 'info');
            
            try {
                // Method 1: Try to get table schema using information_schema
                const { data: columns, error: schemaError } = await supabase
                    .from('information_schema.columns')
                    .select('column_name, data_type, is_nullable')
                    .eq('table_name', 'Products')
                    .eq('table_schema', 'public');

                if (schemaError) {
                    log(`‚ùå Schema query error: ${schemaError.message}`, 'error');
                } else if (columns && columns.length > 0) {
                    log('‚úÖ Found columns via schema:', 'success');
                    columns.forEach(col => {
                        log(`  - ${col.column_name} (${col.data_type})`, 'info');
                    });
                } else {
                    log('‚ö†Ô∏è No columns found via schema query', 'error');
                }

                // Method 2: Try to select with limit 0 to get column names
                log('\nüîç Trying to get column structure via empty query...', 'info');
                const { data: emptyData, error: emptyError } = await supabase
                    .from('Products')
                    .select('*')
                    .limit(0);

                if (emptyError) {
                    log(`‚ùå Empty query error: ${emptyError.message}`, 'error');
                } else {
                    log('‚úÖ Empty query successful (table exists)', 'success');
                }

                // Method 3: Try to get one row to see actual structure
                log('\nüîç Trying to get one sample row...', 'info');
                const { data: sampleData, error: sampleError } = await supabase
                    .from('Products')
                    .select('*')
                    .limit(1);

                if (sampleError) {
                    log(`‚ùå Sample query error: ${sampleError.message}`, 'error');
                } else if (sampleData && sampleData.length > 0) {
                    log('‚úÖ Sample data found! Column names:', 'success');
                    const columnNames = Object.keys(sampleData[0]);
                    columnNames.forEach(name => {
                        log(`  - "${name}" = ${JSON.stringify(sampleData[0][name])}`, 'info');
                    });
                } else {
                    log('‚ö†Ô∏è No sample data found (table might be empty)', 'error');
                }

            } catch (error) {
                log(`‚ùå Unexpected error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        async function listAllTables() {
            clearLog();
            log('üîç Listing all available tables...', 'info');
            
            try {
                // Try to get all table names
                const { data: tables, error } = await supabase
                    .from('information_schema.tables')
                    .select('table_name')
                    .eq('table_schema', 'public')
                    .eq('table_type', 'BASE TABLE');

                if (error) {
                    log(`‚ùå Error listing tables: ${error.message}`, 'error');
                } else if (tables && tables.length > 0) {
                    log('‚úÖ Available tables:', 'success');
                    tables.forEach(table => {
                        log(`  - ${table.table_name}`, 'info');
                    });
                } else {
                    log('‚ö†Ô∏è No tables found', 'error');
                }
            } catch (error) {
                log(`‚ùå Unexpected error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        async function testSampleData() {
            clearLog();
            log('üîç Getting sample data from Products table...', 'info');
            
            try {
                const { data, error } = await supabase
                    .from('Products')
                    .select('*')
                    .limit(3);

                if (error) {
                    log(`‚ùå Error: ${error.message}`, 'error');
                } else if (data && data.length > 0) {
                    log(`‚úÖ Found ${data.length} sample record(s):`, 'success');
                    data.forEach((record, index) => {
                        log(`\nRecord ${index + 1}:`, 'info');
                        Object.entries(record).forEach(([key, value]) => {
                            log(`  ${key}: ${JSON.stringify(value)}`, 'info');
                        });
                    });
                } else {
                    log('‚ö†Ô∏è Table exists but has no data', 'error');
                }
            } catch (error) {
                log(`‚ùå Unexpected error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        // Auto-load message
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Table discovery tool loaded. Click buttons to explore your database structure.', 'success');
        });
    </script>
</body>
</html>
